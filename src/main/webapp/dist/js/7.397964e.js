(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{506:function(t,e,i){var o=i(536);"string"==typeof o&&(o=[[t.i,o,""]]),o.locals&&(t.exports=o.locals);(0,i(63).default)("7456ae46",o,!1,{})},514:function(t,e,i){"use strict";var o=function(){var t=this.$createElement;return(this._self._c||t)("textarea",{ref:"editor"})};o._withStripped=!0;var n={props:{options:{type:Array,required:!1},width:{type:[Number,String],default:"100%"},height:{type:[Number,String],default:200},uploadPath:{type:String,default:""},value:String,readonly:{type:Boolean,default:!1},tools:{type:Array,default:function(){return["source","|","undo","redo","|","preview","print","template","code","cut","copy","paste","plainpaste","wordpaste","|","justifyleft","justifycenter","justifyright","justifyfull","insertorderedlist","insertunorderedlist","indent","outdent","subscript","superscript","clearhtml","quickformat","selectall","|","fullscreen","/","formatblock","fontname","fontsize","|","forecolor","hilitecolor","bold","italic","underline","strikethrough","lineheight","removeformat","|","image","multiimage","flash","media","insertfile","table","hr","emoticons","baidumap","pagebreak","anchor","link","unlink"]}}},data:function(){return{id:null,editor:null,elWidth:null,elHeight:null}},methods:{guid:function(){function t(){return(65536*(1+Math.random())|0).toString(16).substring(1)}return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()},init:function(){this.id=this.guid(),this.$refs.editor.id=this.id;var t=this;this.$nextTick(function(){t.editor=KindEditor.create("#"+t.id,{width:t.getUnit(t.elWidth),height:t.getUnit(t.elHeight),minWidth:t.getUnit(t.elWidth),minHeight:t.getUnit(t.elHeight),allowFileManager:!1,filePostName:"fileUpload",uploadJson:"".concat("/","/File/1").replace("//","/"),allowImageUpload:!0,afterChange:function(){t.$emit("input",a(this.html()))},items:t.tools}),t.readonly&&t.editor.readonly(t.readonly),t.editor.html(t.value)})},remove:function(){this.elWidth=this.editor.width,this.elHeight=this.editor.height,KindEditor.remove("#"+this.id),this.editor.remove(),this.editor=null,this.id=null},getUnit:function(t){return"%"==String(t).split("").pop()?t:Number.parseFloat(t)+"px"}},mounted:function(){this.elWidth=this.width,this.elHeight=this.height,this.init()},activated:function(){this.id||this.init()},deactivated:function(){this.remove()},destroyed:function(){this.remove()},watch:{value:function(t){this.editor&&a(this.editor.html())!=t&&this.editor.html(t)},readonly:function(t){this.editor.readonly(t)}}},a=function(t){return t.replace(/<embed.*?\/>/g,function(t,e,i){var o=t.match(/src="(.*?)"/)[1],n=t.match(/width="(.*?)"/)[1],a=t.match(/height="(.*?)"/)[1],s="";return"true"==t.match(/autostart="(.*?)"/)[1]&&(s+=' autoplay="autoplay"'),"true"==t.match(/loop="(.*?)"/)[1]&&(s+=' loop="loop"'),'<video src="'.concat(o,'" width="').concat(n,'" height="').concat(a,'" ').concat(s,' controls="controls"></video>')})},s=n,l=i(23),r=Object(l.a)(s,o,[],!1,null,null,null);r.options.__file="src/components/editor/index.vue";e.a=r.exports},535:function(t,e,i){"use strict";var o=i(506);i.n(o).a},536:function(t,e,i){},557:function(t,e,i){"use strict";i.r(e);var o=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"box"},[i("h5",{staticClass:"box__title"},[e._m(0),e._v(" "),i("el-button-group",{staticClass:"box__buttons",attrs:{size:"small"}},["view"!=e.vo.mode?i("el-button",{attrs:{type:"info",icon:"el-icon-edit",size:"small"},on:{click:e.edit}},[e._v("保存")]):e._e(),e._v(" "),i("el-button",{attrs:{type:"info",icon:"el-icon-d-arrow-left",size:"small"},on:{click:e.back}},[e._v("返回")])],1)],1),e._v(" "),i("el-form",{ref:"baseForm",staticClass:"box__form",attrs:{disabled:"view"==e.vo.mode,model:e.po.base,"label-width":"120px",rules:e.vo.baseRiles}},[i("el-form-item",{attrs:{label:"学校名称/分园",prop:"branch_school_id"}},[i("el-cascader",{staticStyle:{width:"100%"},attrs:{options:e.vo.schools,size:"small",props:e.vo.props},on:{"active-item-change":e.handleItemChange},model:{value:e.po.schools,callback:function(t){e.$set(e.po,"schools",t)},expression:"po.schools"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"标题",prop:"title"}},[i("el-input",{model:{value:e.po.base.title,callback:function(t){e.$set(e.po.base,"title",t)},expression:"po.base.title"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"管理状态"}},[i("el-select",{attrs:{placeholder:"请选择"},model:{value:e.po.base.management_status_id,callback:function(t){e.$set(e.po.base,"management_status_id",t)},expression:"po.base.management_status_id"}},e._l(e.vo.managementStatusList,function(t){return i("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}))],1),e._v(" "),i("el-form-item",{attrs:{label:"类别",prop:"information_type_id"}},[i("el-select",{attrs:{placeholder:"请选择"},model:{value:e.po.base.information_type_id,callback:function(t){e.$set(e.po.base,"information_type_id",t)},expression:"po.base.information_type_id"}},e._l(e.vo.informationTypeList,function(t){return i("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}))],1),e._v(" "),i("el-form-item",{attrs:{label:"子类别",prop:"information_subtype_id"}},[i("el-select",{attrs:{placeholder:"请选择"},model:{value:e.po.base.information_subtype_id,callback:function(t){e.$set(e.po.base,"information_subtype_id",t)},expression:"po.base.information_subtype_id"}},e._l(e.vo.informationSubtypeList,function(t){return i("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}))],1),e._v(" "),i("el-form-item",{attrs:{label:"封面"}},[i("el-upload",{staticClass:"upload-demo",attrs:{action:e.vo.uploadImgURL,accept:"image/*",multiple:!1,limit:1,"file-list":e.vo.fileList,limi:1,name:"fileUpload","on-success":e.fileUploadSuccess,"on-remove":e.fileRemove,"list-type":"picture"}},[i("el-button",{attrs:{size:"small",type:"primary"}},[e._v("点击上传")]),e._v(" "),i("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("只能上传jpg/png文件，且不超过500kb")])],1)],1),e._v(" "),i("el-form-item",{attrs:{label:"内容"}},[i("editor",{attrs:{height:400,readonly:"view"==e.vo.mode},model:{value:e.po.base.content,callback:function(t){e.$set(e.po.base,"content",t)},expression:"po.base.content"}})],1)],1)],1)};o._withStripped=!0;var n={data:function(){return{po:{id:"",schools:[],base:{school_id:null,branch_school_id:null,information_type_id:null,information_subtype_id:null,management_status_id:null,title:"",photo_url:"",content:""}},vo:{mode:"add",schools:[],informationTypeList:[],informationSubtypeList:[],props:{value:"id",label:"name",children:"children"},managementStatusList:[{id:0,name:"Created"},{id:1,name:"Vaildated"},{id:2,name:"Published"},{id:3,name:"Reviked"}],baseRiles:{branch_school_id:[{required:!0,message:"请选择学校和分校",trigger:"change"}],title:[{required:!0,message:"请输入标题",trigger:"blur"}],information_type_id:[{required:!0,message:"请选择类别",trigger:"change"}],information_subtype_id:[{required:!0,message:"请选择子类别",trigger:"change"}]},fileList:[],uploadImgURL:"/File/1"}}},computed:{},methods:{handleItemChange:function(t){1==t.length&&this.getBranchSchools(t[0])},getSchools:function(){var e=this;this.$get("/Schools").then(function(t){e.vo.schools=t.map(function(t){return t.children=[],t})}).catch(function(t){t&&e.$alert(t.message,"错误","error")})},getBranchSchools:function(l){var r=this;l&&this.$get("/BranchSchools",{SchoolId:l}).then(function(t){var e=!0,i=!1,o=void 0;try{for(var n,a=r.vo.schools[Symbol.iterator]();!(e=(n=a.next()).done);e=!0){var s=n.value;if(s.id==l){s.children=t;break}}}catch(t){i=!0,o=t}finally{try{e||null==a.return||a.return()}finally{if(i)throw o}}}).catch(function(t){t&&r.$alert(t.message,"错误","error")})},getTypeList:function(){var e=this;this.$get("/InformationTypes").then(function(t){e.vo.informationTypeList=t.dataset}).catch(function(t){t&&e.$alert(t.message,"错误","error")})},getSubTypeList:function(){var e=this;this.$get("/InformationSubtypes").then(function(t){e.vo.informationSubtypeList=t.dataset}).catch(function(t){t&&e.$alert(t.message,"错误","error")})},add:function(){var e=this;this.$post("/SchoolInformation",this.po.base).then(function(t){e.$alert("添加成功","提示","info")}).catch(function(t){t&&e.$alert(t.message,"错误","error")})},edit:function(){var e=this;this.$refs.baseForm.validate(function(t){t&&("add"==e.vo.mode?e.add():e.$put("/SchoolInformation/".concat(e.po.id),e.po.base).then(function(t){e.$alert("修改成功","提示","info")}).catch(function(t){t&&e.$alert(t.message,"错误","error")}))})},getInfo:function(){var i=this;this.$get("/SchoolInformation/".concat(this.po.id)).then(function(e){Object.keys(i.po.base).forEach(function(t){(e[t]||0===e[t])&&(i.po.base[t]=e[t]),e.school_id&&(i.po.schools.push(e.school_id),i.getBranchSchools(e.school_id)),e.branch_school_id&&i.po.schools.push(e.branch_school_id)})}).catch(function(t){t&&i.$alert(t.message,"错误","error")})},fileUploadSuccess:function(t,e,i){0==t.code?this.po.base.photo_url="http://39.96.211.124/images/"+t.data.path:this.po.base.photo_url=""},fileRemove:function(){this.po.base.photo_url=""},back:function(){this.$router.back()}},created:function(){this.$route.params.id&&(0<this.$route.path.indexOf("view")?this.vo.mode="view":this.vo.mode="edit",this.po.id=this.$route.params.id,this.getInfo()),this.getSchools(),this.getTypeList(),this.getSubTypeList()},watch:{"po.schools":function(t){this.po.base.branch_school_id=t?(this.po.base.school_id=t[0],t[1]):this.po.base.school_id=null}},components:{editor:i(514).a}},a=(i(535),i(23)),s=Object(a.a)(n,o,[function(){var t=this.$createElement,e=this._self._c||t;return e("span",[e("i",{staticClass:"el-icon-tickets"}),this._v("编辑页面")])}],!1,null,"44e6db30",null);s.options.__file="src/pages/schoolInformation/edit/index.vue";e.default=s.exports}}]);