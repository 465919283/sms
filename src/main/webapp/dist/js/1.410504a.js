(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{509:function(e,t,s){var i=s(542);"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);(0,s(63).default)("1d266192",i,!1,{})},541:function(e,t,s){"use strict";var i=s(509);s.n(i).a},542:function(e,t,s){},562:function(e,t,s){"use strict";s.r(t);var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"box"},[s("h5",{staticClass:"box__title"},[s("span",[s("i",{staticClass:"el-icon-tickets"}),t._v(t._s("view"==t.vo.mode?"查看详情":"编辑页面"))]),t._v(" "),s("el-button-group",{staticClass:"box__buttons",attrs:{size:"small"}},["view"!=t.vo.mode?s("el-button",{attrs:{type:"info",icon:"el-icon-edit",size:"small"},on:{click:t.edit}},[t._v("保存")]):t._e(),t._v(" "),s("el-button",{attrs:{type:"info",icon:"el-icon-d-arrow-left",size:"small"},on:{click:t.back}},[t._v("返回")])],1)],1),t._v(" "),s("el-form",{ref:"baseForm",staticClass:"box__form",attrs:{disabled:"view"==t.vo.mode,model:t.po.base,"label-width":"120px",rules:t.vo.baseRiles}},[s("el-form-item",{attrs:{label:"名称",prop:"name"}},[s("el-input",{model:{value:t.po.base.name,callback:function(e){t.$set(t.po.base,"name",e)},expression:"po.base.name"}})],1),t._v(" "),s("el-form-item",{attrs:{label:"学校/科目",prop:"subject_id"}},[s("el-cascader",{staticStyle:{width:"400px"},attrs:{options:t.vo.schools,props:t.vo.props},on:{"active-item-change":t.handleItemChange},model:{value:t.po.base.subject_id,callback:function(e){t.$set(t.po.base,"subject_id",e)},expression:"po.base.subject_id"}})],1),t._v(" "),s("el-form-item",{attrs:{label:"描述",prop:"description"}},[s("el-input",{model:{value:t.po.base.description,callback:function(e){t.$set(t.po.base,"description",e)},expression:"po.base.description"}})],1),t._v(" "),s("el-form-item",{attrs:{label:"封面"}},[s("el-upload",{staticClass:"upload-demo",attrs:{action:t.vo.uploadImgURL,accept:"image/*",multiple:!1,limit:1,"file-list":t.vo.fileList,limi:1,name:"fileUpload","on-success":t.fileUploadSuccess,"on-remove":t.fileRemove,"list-type":"picture"}},[s("el-button",{attrs:{size:"small",type:"primary"}},[t._v("点击上传")]),t._v(" "),s("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[t._v("只能上传jpg/png文件，且不超过500kb")])],1)],1),t._v(" "),s("el-form-item",{attrs:{label:"管理状态"}},[s("el-select",{attrs:{placeholder:"请选择"},model:{value:t.po.base.management_status_id,callback:function(e){t.$set(t.po.base,"management_status_id",e)},expression:"po.base.management_status_id"}},t._l(t.vo.managementStatusList,function(e){return s("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}))],1)],1)],1)};i._withStripped=!0;var o={data:function(){return{po:{id:"",base:{management_status_id:null,name:"",description:"",photo_url:"",subject_id:[],user_id:1,user_name:"administrator"}},vo:{mode:"add",schools:[],subjects:[],managementStatusList:[{id:0,name:"Created"},{id:1,name:"Vaildated"},{id:2,name:"Published"},{id:3,name:"Reviked"}],baseRiles:{subject_id:[{required:!0,message:"请选择学校/科目",trigger:"change"}],name:[{required:!0,message:"请输入名称",trigger:"blur"}],description:[{required:!0,message:"请输入描述",trigger:"blur"}]},fileList:[],uploadImgURL:"/File/1",props:{value:"id",label:"name",children:"children"}}}},computed:{},methods:{handleItemChange:function(e){1==e.length&&this.getSubjects(e[0])},getSchools:function(){var t=this;this.$get("/Schools").then(function(e){t.vo.schools=e.map(function(e){return e.children=[],e})}).catch(function(e){e&&t.$alert(e.message,"错误","error")})},getSubjects:function(r){var l=this;r&&this.$get("/Subjects",{schoolId:r,limit:9999999,offset:0,paginationData:{query_type:1,query_id:0,page_mode:1},_:{query_type:1,query_id:0,page_mode:1}}).then(function(e){var t=!0,s=!1,i=void 0;try{for(var o,a=l.vo.schools[Symbol.iterator]();!(t=(o=a.next()).done);t=!0){var n=o.value;if(n.id==r){n.children=(e.dataset||[]).map(function(e){return e});break}}}catch(e){s=!0,i=e}finally{try{t||null==a.return||a.return()}finally{if(s)throw i}}}).catch(function(e){e&&l.$alert(e.message,"错误","error")})},add:function(){var t=this,e=JSON.parse(JSON.stringify(this.po.base));e.subject_id=this.po.base.subject_id[1],this.$post("/Course",e).then(function(e){t.$alert("添加成功","提示","info")}).catch(function(e){e&&t.$alert(e.message,"错误","error")})},edit:function(){var s=this;this.$refs.baseForm.validate(function(e){if(e)if("add"==s.vo.mode)s.add();else{var t=JSON.parse(JSON.stringify(s.po.base));t.subject_id=s.po.base.subject_id[1],t.id=s.po.id,s.$put("/Course/".concat(s.po.id),t).then(function(e){s.$alert("修改成功","提示","info")}).catch(function(e){e&&s.$alert(e.message,"错误","error")})}})},getInfo:function(){var t=this;this.$get("/Course/".concat(this.po.id)).then(function(e){t.po.base.management_status_id=e.management_status_id,t.po.base.name=e.name,t.po.base.description=e.description,t.po.base.user_id=e.user_id,t.po.base.user_name=e.user_name,t.po.base.photo_url=e.photo_url,e.photo_url&&t.vo.fileList.push({name:e.photo_url.split("/").pop(),url:e.photo_url}),t.getSubject(e.subject_id)}).catch(function(e){e&&t.$alert(e.message,"错误","error")})},getSubject:function(t){var s=this;this.$get("/Subject/".concat(t)).then(function(e){s.po.base.subject_id.push(e.school_id),s.getSubjects(e.school_id),s.po.base.subject_id.push(t)}).catch(function(e){e&&s.$alert(e.message,"错误","error")})},fileUploadSuccess:function(e,t,s){0==e.code?this.po.base.photo_url="http://39.96.211.124/images/"+e.data.path:this.po.base.photo_url=""},fileRemove:function(){this.po.base.photo_url=""},back:function(){this.$router.back()}},created:function(){this.$route.params.id&&(0<this.$route.path.indexOf("view")?this.vo.mode="view":this.vo.mode="edit",this.po.id=this.$route.params.id,this.getInfo()),this.getSchools()},components:{}},a=(s(541),s(23)),n=Object(a.a)(o,i,[],!1,null,"39b6008d",null);n.options.__file="src/pages/Course/edit/index.vue";t.default=n.exports}}]);