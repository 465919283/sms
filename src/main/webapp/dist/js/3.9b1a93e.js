(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{511:function(e,t,o){var i=o(546);"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);(0,o(63).default)("c05f6264",i,!1,{})},545:function(e,t,o){"use strict";var i=o(511);o.n(i).a},546:function(e,t,o){},552:function(e,t,o){"use strict";o.r(t);var i=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"box"},[o("h5",{staticClass:"box__title"},[o("span",[o("i",{staticClass:"el-icon-tickets"}),t._v(t._s("view"==t.vo.mode?"查看详情":"编辑页面"))]),t._v(" "),o("el-button-group",{staticClass:"box__buttons",attrs:{size:"small"}},["view"!=t.vo.mode?o("el-button",{attrs:{type:"info",icon:"el-icon-edit",size:"small"},on:{click:t.edit}},[t._v("保存")]):t._e(),t._v(" "),o("el-button",{attrs:{type:"info",icon:"el-icon-d-arrow-left",size:"small"},on:{click:t.back}},[t._v("返回")])],1)],1),t._v(" "),o("el-form",{ref:"baseForm",staticClass:"box__form",attrs:{disabled:"view"==t.vo.mode,model:t.po.base,"label-width":"140px",rules:t.vo.baseRiles}},["add"==t.vo.mode?o("el-form-item",{attrs:{label:"学校/科目/课程",prop:"course_id"}},[o("el-cascader",{staticStyle:{width:"400px"},attrs:{options:t.vo.schools,props:t.vo.props},on:{"active-item-change":t.handleItemChange},model:{value:t.po.course_id,callback:function(e){t.$set(t.po,"course_id",e)},expression:"po.course_id"}})],1):o("el-form-item",{attrs:{label:"课程",prop:"course_id"}},[o("el-input",{staticStyle:{width:"400px"},attrs:{disabled:!0},model:{value:t.po.base.course_name,callback:function(e){t.$set(t.po.base,"course_name",e)},expression:"po.base.course_name"}})],1),t._v(" "),o("el-form-item",{attrs:{label:"名称",prop:"name"}},[o("el-input",{model:{value:t.po.base.name,callback:function(e){t.$set(t.po.base,"name",e)},expression:"po.base.name"}})],1),t._v(" "),o("el-form-item",{attrs:{label:"是否在主页展示"}},[o("el-radio-group",{model:{value:t.po.base.is_displayed_on_main_page,callback:function(e){t.$set(t.po.base,"is_displayed_on_main_page",e)},expression:"po.base.is_displayed_on_main_page"}},[o("el-radio",{attrs:{label:1}},[t._v("是")]),t._v(" "),o("el-radio",{attrs:{label:0}},[t._v("否")])],1)],1),t._v(" "),o("el-form-item",{attrs:{label:"是否在推广位展示"}},[o("el-radio-group",{model:{value:t.po.base.is_displayed_on_subject_page,callback:function(e){t.$set(t.po.base,"is_displayed_on_subject_page",e)},expression:"po.base.is_displayed_on_subject_page"}},[o("el-radio",{attrs:{label:1}},[t._v("是")]),t._v(" "),o("el-radio",{attrs:{label:0}},[t._v("否")])],1)],1),t._v(" "),o("el-form-item",{attrs:{label:"简介"}},[o("el-input",{attrs:{type:"textarea",autosize:{minRows:3,maxRows:10}},model:{value:t.po.base.description,callback:function(e){t.$set(t.po.base,"description",e)},expression:"po.base.description"}})],1),t._v(" "),o("el-form-item",{attrs:{label:"背景图片"}},[o("el-upload",{attrs:{action:t.vo.uploadImgURL,accept:"image/*",multiple:!1,limit:1,"file-list":t.vo.imageList,limi:1,name:"fileUpload","on-success":t.fileUploadSuccess,"on-remove":t.fileRemove,"list-type":"picture"}},[o("el-button",{attrs:{size:"small",type:"primary"}},[t._v("点击上传图片")]),t._v(" "),o("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[t._v("只能上传image文件")])],1)],1),t._v(" "),o("el-form-item",{attrs:{label:"音频"}},[o("el-upload",{attrs:{action:t.vo.uploadMediaURL,accept:".ogg,.mp3,.wav",multiple:!1,limit:1,"file-list":t.vo.audioList,limi:1,name:"fileUpload1","on-success":t.file1UploadSuccess,"on-remove":t.file1Remove}},[o("el-button",{attrs:{size:"small",type:"primary"}},[t._v("点击上传音频")]),t._v(" "),o("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[t._v("只能上传ogg/mp3/wav文件")])],1)],1),t._v(" "),o("el-form-item",{attrs:{label:"视频"}},[o("el-upload",{attrs:{action:t.vo.uploadMediaURL,accept:".ogg,.mp4,.webm",multiple:!1,limit:1,"file-list":t.vo.videoList,limi:1,name:"fileUpload2","on-success":t.file2UploadSuccess,"on-remove":t.file2Remove}},[o("el-button",{attrs:{size:"small",type:"primary"}},[t._v("点击上传视频")]),t._v(" "),o("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[t._v("只能上传ogg/mp4/webm文件")])],1)],1)],1)],1)};i._withStripped=!0;var a={data:function(){return{po:{id:"",course_id:[],base:{name:"",course_id:null,course_name:"",description:"",is_combo_type:0,is_displayed_on_main_page:0,is_displayed_on_subject_page:0,photo_url:"",audio_url:"",video_url:""}},vo:{mode:"add",schools:[],props:{value:"id",label:"name",children:"children"},imageList:[],audioList:[],videoList:[],uploadImgURL:"/File/1",uploadMediaURL:"/File/2",baseRiles:{course_id:[{required:!0,message:"请选择课程",trigger:"change"}],name:[{required:!0,message:"请输入名称",trigger:"blur"}]}}}},computed:{},methods:{handleItemChange:function(e){1==e.length?this.getSubject(e[0]):2==e.length&&this.getCourses(e[0],e[1])},getSchools:function(){var t=this;this.$get("/Schools").then(function(e){t.vo.schools=e.map(function(e){return e.children=[],e})}).catch(function(e){e&&t.$alert(e.message,"错误","error")})},getSubject:function(r){var n=this;this.$get("/Subjects",{schoolId:r,limit:9999999,offset:0,paginationData:{query_type:1,query_id:0,page_mode:1},_:{query_type:1,query_id:0,page_mode:1}}).then(function(e){var t=!0,o=!1,i=void 0;try{for(var a,s=n.vo.schools[Symbol.iterator]();!(t=(a=s.next()).done);t=!0){var l=a.value;if(l.id==r){l.children=(e.dataset||[]).map(function(e){return e.children=[],e});break}}}catch(e){o=!0,i=e}finally{try{t||null==s.return||s.return()}finally{if(o)throw i}}}).catch(function(e){e&&n.$alert(e.message,"错误","error")})},getCourses:function(m,_){var v=this;this.$get("/Courses",{subjectId:_,limit:9999999,offset:0,paginationData:{query_type:1,query_id:0,page_mode:1},_:{query_type:1,query_id:0,page_mode:1}}).then(function(e){var t=!0,o=!1,i=void 0;try{for(var a,s=v.vo.schools[Symbol.iterator]();!(t=(a=s.next()).done);t=!0){var l=a.value;if(l.id==m){var r=!0,n=!1,u=void 0;try{for(var c,p=l.children[Symbol.iterator]();!(r=(c=p.next()).done);r=!0){var d=c.value;if(d.id==_){d.children=e.dataset||[];break}}}catch(e){n=!0,u=e}finally{try{r||null==p.return||p.return()}finally{if(n)throw u}}break}}}catch(e){o=!0,i=e}finally{try{t||null==s.return||s.return()}finally{if(o)throw i}}}).catch(function(e){e&&v.$alert(e.message,"错误","error")})},add:function(){var t=this;this.$post("/Courseware",this.po.base).then(function(e){t.$alert("添加成功","提示","info")}).catch(function(e){e&&t.$alert(e.message,"错误","error")})},edit:function(){var t=this;this.$refs.baseForm.validate(function(e){e&&("add"==t.vo.mode?t.add():t.$put("/Courseware/".concat(t.po.id),Object.assign({},t.po.base,{id:t.po.id})).then(function(e){t.$alert("修改成功","提示","info")}).catch(function(e){e&&t.$alert(e.message,"错误","error")}))})},getInfo:function(){var o=this;this.$get("/Courseware/".concat(this.po.id)).then(function(t){Object.keys(o.po.base).forEach(function(e){(t[e]||0===t[e])&&(o.po.base[e]=t[e])}),t.photo_url&&o.vo.imageList.push({name:t.photo_url.split("/").pop(),url:t.photo_url}),t.audio_url&&o.vo.audioList.push({name:t.audio_url.split("/").pop(),url:t.audio_url}),t.video_url&&o.vo.videoList.push({name:t.video_url.split("/").pop(),url:t.video_url})}).catch(function(e){e&&o.$alert(e.message,"错误","error")})},fileUploadSuccess:function(e,t,o){0==e.code?this.po.base.photo_url="http://39.96.211.124/images/"+e.data.path:this.po.base.photo_url=""},file1UploadSuccess:function(e,t,o){0==e.code?this.po.base.audio_url="http://39.96.211.124/images/"+e.data.path:this.po.base.audio_url=""},file2UploadSuccess:function(e,t,o){0==e.code?this.po.base.video_url="http://39.96.211.124/images/"+e.data.path:this.po.base.video_url=""},fileRemove:function(){this.po.base.photo_url=""},file1Remove:function(){this.po.base.audio_url=""},file2Remove:function(){this.po.base.video_url=""},back:function(){this.$router.back()}},created:function(){this.$route.params.id&&(0<this.$route.path.indexOf("view")?this.vo.mode="view":this.vo.mode="edit",this.po.id=this.$route.params.id,this.getInfo()),this.getSchools()},watch:{"po.course_id":function(e){e&&3==e.length?this.po.base.course_id=e[2]:this.po.base.course_id=null}}},s=(o(545),o(23)),l=Object(s.a)(a,i,[],!1,null,"7f818010",null);l.options.__file="src/pages/courseware/edit/index.vue";t.default=l.exports}}]);